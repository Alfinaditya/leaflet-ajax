L.GeoJSON.AJAX=L.GeoJSON.extend({defaultAJAXparams:{dataType:"json",callbackParam:"callback",middleware:function(e){return e}},initialize:function(e,t){this._url=e;var a=L.Util.extend({},this.defaultAJAXparams);for(var r in t){if(this.defaultAJAXparams.hasOwnProperty(r)){a[r]=t[r]}}this._cache=[];this.ajaxParams=a;this._layers={};L.Util.setOptions(this,t);if(this._url){this.addUrl(this._url)}},addUrl:function(e){var t=this;t._url=e;if(this.ajaxParams.dataType.toLowerCase()==="json"){L.Util.ajax(e,function(e){var a=t.ajaxParams.middleware(e);t._cache=t._cache.concat(a.features);t.addData(a);t.fire("dataLoaded")})}else if(this.ajaxParams.dataType.toLowerCase()==="jsonp"){L.Util.jsonp(e,function(e){var a=t.ajaxParams.middleware(e);t._cache=t._cache.concat(a.features);t.addData(a);t.fire("dataLoaded")},t.ajaxParams.callbackParam)}},refresh:function(e){e=e||this._url;this.clearLayers();this.addUrl(e)},refilter:function(e){if(typeof e!=="function"){e=function(){return true}}this.clearLayers();this.addData(this._cache.filter(e))}});L.geoJson.ajax=function(e,t){return new L.GeoJSON.AJAX(e,t)};L.Util.ajax=function(url,cb){if(window.XMLHttpRequest===undefined){window.XMLHttpRequest=function(){try{return new ActiveXObject("Microsoft.XMLHTTP.6.0")}catch(e){try{return new ActiveXObject("Microsoft.XMLHTTP.3.0")}catch(t){throw new Error("XMLHttpRequest is not supported")}}}}var response,request=new XMLHttpRequest;request.open("GET",url);request.onreadystatechange=function(){if(request.readyState===4&&request.status===200){if(window.JSON){response=JSON.parse(request.responseText)}else{response=eval("("+request.responseText+")")}cb(response)}};request.send()};L.Util.jsonp=function(e,t,a,r){var s,i,n,c,o=document.getElementsByTagName("head")[0];var a=a||"callback";if(r){s=r}else{n="_"+(""+Math.random()).slice(2);s="L.Util.jsonp.cb."+n}c=L.DomUtil.create("script","",o);c.type="text/javascript";if(n){L.Util.jsonp.cb[n]=function(e){o.removeChild(c);delete L.Util.jsonp.cb[n];t(e)}}if(e.indexOf("?")===-1){i=e+"?"+a+"="+s}else{i=e+"&"+a+"="+s}c.src=i};L.Util.jsonp.cb={};